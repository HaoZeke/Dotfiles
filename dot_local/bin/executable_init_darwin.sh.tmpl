#!/usr/bin/env sh

# Helpers
chck() { command -v $1 > /dev/null && echo $? ; }

# Brew
command -v brew > /dev/null || { \
    echo "Homebrew not found, installing"  &&  \
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)" \
;}

# Basics
# Always grab these, just in case
brew install git gh \
    openssh openssl \
    mosh ssh-copy-id \
    aria2 wget tree fzf \
    wakatime-cli neofetch \
    gfortran gcc borgbackup yq

# Encryption + TeX
set -- "brew" "age" "gpg-tui" \
    "tectonic" "biber"
for item in "$@"; do
    if [ $(chck "$item") ]; then
        echo "Found $item";
    else
        echo "Installing $item" && \
        brew install $item;
    fi;
done

# Bundle, mostly casks
brew bundle --force --file=/dev/stdin <<EOF
# Taps
tap "homebrew/core"
tap "homebrew/bundle"
tap "homebrew/cask" # GUI applications
tap "homebrew/cask-versions" # Alternates
tap "homebrew/services" # Integrates with launctl
tap "homebrew/cask-fonts" # Fonts
tap "buo/cask-upgrade" # Provides brew cu
brew "mas" # Mac App Store CLI

# Encryption
cask "enpass"
cask "cryptomator"
cask "keybase"
cask "authy"

# Tools
cask "keka" # Archiver
cask "hammerspoon" # System Control
cask "karabiner-elements" # Keyboard
cask "qview" # Image viewer
cask "alfred" # Launcher
brew "tailscale" # Local network
cask "windscribe" # VPN
cask "oversight" # Monitor cam/mic
cask "tomighty" # Pomodoro
mas "Amphetamine", id: 937984704

# Editors / Notes
cask "obsidian"
cask "journey"
cask "visual-studio-code"
brew "neovim"

# Development
mas "Xcode", id: 497799835
cask "docker" # Dev environments

# Personal Comm
mas "Telegram", id: 747648890
cask "whatsapp"
cask "zoom"
cask "mailmate"

# Work Comm
mas 'Slack', id: 803453959
cask "zulip"
cask "microsoft-teams"
cask "element"
cask "discord"

# Terminals
cask "tabby"
cask "alacritty"
brew "termius"

# Research
cask "zotero"

# Readers
cask "remarkable"
cask "calibre"

# Trackers
cask "rescuetime"
cask "toggl-track"

# Browsers
cask "firefox-developer-edition"
cask "google-chrome"

# Backup
cask "resilio-sync"
cask "insync"

# Media
cask "spotify"
cask "plex-media-player"
cask "smplayer"

# Media Editing
cask "obs"
cask "losslesscut"
cask "keycastr"

# Fonts
brew "fontconfig"
cask "font-fontawesome"
cask "font-devicons"
cask "font-eb-garamond"

# Cascadia Code
cask "font-cascadia-code"
cask "font-cascadia-code-pl"
cask "font-cascadia-mono"
cask "font-cascadia-mono-pl"

# NerdFonts
cask "font-caskaydia-cove-nerd-font"
cask "font-hack-nerd-font"
cask "font-fira-mono-nerd-font"

EOF

# Silver searcher
command -v ag > /dev/null || { \
    brew install the_silver_searcher ; \
}

# Zathura
# https://github.com/zegervdv/homebrew-zathura
command -v zathura > /dev/null || { \
    brew tap zegervdv/zathura && \
    brew install zathura-pdf-mupdf && \
    mkdir -p $(brew --prefix zathura)/lib/zathura  && \
    ln -s $(brew --prefix zathura-pdf-mupdf)/libpdf-mupdf.dylib $(brew --prefix zathura)/lib/zathura/libpdf-mupdf.dylib ;\
}

# Common includes
# Rust has a unified installer, for MacOS and Linux
# TODO: Handle Windows
{{- include "dot_local/bin/executable_init_rust.sh" -}}

# Emacs Stuff (cross platform)
# Local Variables:
# mode: shell-script
# End:
