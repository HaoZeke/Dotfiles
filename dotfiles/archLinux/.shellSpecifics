###############################
# ArchLinux shell extensions  #
###############################

# Aliases
##########

alias ratemi='sudo reflector --verbose  -l 20 -p http --sort rate --save /etc/pacman.d/mirrorlist' # --country 'India'
alias pacunlock="sudo rm /var/lib/pacman/db.lck"   # Delete the lock file /var/lib/pacman/db.lck
alias paclock="sudo touch /var/lib/pacman/db.lck"  # Create the lock file /var/lib/pacman/db.lck

alias mediaserve='rygel --config=/home/$USER/.config/rygel.conf'
alias pizza.py='~/Github/pizza-9Oct15/src/pizza.py'
alias FlashTool='sudo FlashTool'
alias cantata='cantata -style=gtk2'
alias cpv="rsync -poghb --backup-dir=/tmp/rsync -e /dev/null --progress --"

# Trizen stuff
alias tris="trizen -Ss"
alias trince='trizen -S --noedit --noconfirm'

# Alias for External Hard Disk
alias Storage='/run/media/$USER/Storage'

# IE Alias.
# To get this working install winetricks and run
# WINEARCH=win32 WINEPREFIX=~/.wine-ie6 winetricks ie6
alias ie6=' WINEARCH=win32 WINEPREFIX=~/.wine-ie6 wine ~/.wine-ie6/drive_c/Program\ Files/Internet\ Explorer/IEXPLORE.EXE'


# Check later  $$

# Encfs Safe Files
alias z3op='mkdir /home/$USER/Encfs/Secrets ;encfs -i 5 /run/media/$USER/Storage/.Secrets /home/$USER/Encfs/Secrets'
alias z3cl='sudo umount /home/$USER/Encfs/Secrets ; rm -rf /home/$USER/Encfs/Secrets'

# Docker Aliases
alias airsonicDocker='docker run -v /run/media/haozeke/Storage/Music:/airsonic/music -v /run/media/haozeke/Storage/Music/airsonicData:/airsonic/data -p 4050:4040 -d airsonic/airsonic'
alias crdroidDocker='docker run -it -h crdroid -v /run/media/haozeke/Storage/AndBuild/:/home/build/Android -v /home/haozeke/.ccache/:/home/build/.ccache -v /home/haozeke/.cache/:/home/build/.cache crdroid'
alias plexDocker='docker run plex'

# Convert this!!
alias calibreDocker='calibre-server --port 8264 --userdb /run/media/haozeke/Storage/Library/calServUsers.sqlite --enable-auth --daemonize --log=/home/haozeke/.calServLog'


# Functions
#############

# Orphaned Packages.
orphans() {
  if [[ ! -n $(pacaur -Qdt) ]]; then
    echo "No orphans to remove."
  else
    sudo powerpill -Rns $(powerpill -Qdtq)
  fi
}

droidBuild() {
  echo "Setting up environment variables\n"
  export USE_HOST_LEX=yes       # Prevent builds breaking..
  # Sets the right path for linkers. cm-12.1 only.
  #export LD_LIBRARY_PATH=/run/media/haozeke/Storage/AndBuild/cm-12.1/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.8/lib/
  echo "Getting the right Python\n"
  source /run/media/haozeke/Storage/AndBuild/venv/bin/activate
  echo "Getting the right tools for Gello \n"
  export PATH=$HOME/Github/Linux/depot_tools:$PATH
  echo "Enjoy.\n"
}


# Sources
##########

# For tilix to not complain about login shells.
source /etc/profile.d/vte.sh

# added by travis gem
[ -f $HOME/.travis/travis.sh ] && source $HOME/.travis/travis.sh

# For Amber
test -f /home/haozeke/Github/amber16/amber.sh && source /home/haozeke/Github/amber16/amber.sh

# Commands
###########

if command -v ccache >/dev/null 2>&1; then
  ccache -M 50G  >/dev/null
  export USE_CCACHE=1
else
  echo "You seem to be missing ccache"
fi

if [[ -d $HOME/.virtualenvs ]]; then
  export WORKON_HOME=~/.virtualenvs
  VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
  source /usr/bin/virtualenvwrapper.sh
else
  echo "You seem to be missing virtualenvs"
fi

if command -v direnv >/dev/null 2>&1; then
  eval "$(direnv hook zsh)"
else
  echo "You seem to be missing direnv"
fi

# Gets powerpill to work with pacaur
if command -v powerpill >/dev/null 2>&1; then
  export PACMAN='powerpill'
else
  echo "You seem to be missing powerpill"
fi

if command -v mmake >/dev/null 2>&1; then
  alias make=mmake
else
  echo "You seem to be missing mmake"
fi

# Java Fixes

# MATLAB Helper
# wmname LG3D  Depreceiated in favor of script; for breaking xfce4-panel windowmanager.
# Replaced with a shell script hack to prevent or try to suppress crap on the command line.
# export _JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel'
export _SILENT_JAVA_OPTIONS='-Dawt.useSystemAAFontSettings=on -Dswing.aatext=true -Dswing.defaultlaf=com.sun.java.swing.plaf.gtk.GTKLookAndFeel'
unset _JAVA_OPTIONS
alias java='java "$_SILENT_JAVA_OPTIONS"'
export JAVA_FONTS=/usr/share/fonts/TTF

# Exports
###########

export EDITOR='nvim'

# NPM Stuff
export npm_config_prefix=~/.node_modules

# Horrible hack for themes to work
export XDG_CURRENT_DESKTOP=KDE

export MPD_HOST='192.168.31.4'

export WINEPREFIX=$HOME/.wine/
export WINEARCH=win32

export QT_QPA_PLATFORMTHEME=qt5ct
export QT_AUTO_SCREEN_SCALE_FACTOR=0

export LD=ld.gold

export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export LANGUAGE=en_US.UTF-8

# Prevent ROM builds breaking..
export USE_HOST_LEX=yes

# Otherwise bspwm kinda kills java GUI's
export _JAVA_AWT_WM_NONREPARENTING=1

# For Key signatures
export GPG_TTY=$(tty)

# Use pacman's keyring for gnupg (only temporary)
#export GNUPGHOME=/etc/pacman.d/gnupg

# Stop breaking Wine
export WINEARCH=win32

# For Docker pushes
export DOCKER_ID_USER=$USER

# Makes fonts darker and thicker
export INFINALITY_FT_BRIGHTNESS="-10"

# Not too sharp, not too smooth
export INFINALITY_FT_FILTER_PARAMS="16 20 28 20 16"

# PATH Changes
################

# Pre path [overrides] #
export PATH="$HOME/Github/Dotfiles/Scripts:$HOME/.node_modules/bin:$PATH"

# Post Path [additions] #

# Miner Path
export PATH="$PATH:$HOME/Github/Linux/xmr-stak-cpu/bin"

# Add snaps to the path
export PATH="$PATH:/var/lib/snapd/snap/bin"

# Add ruby gems to the path
export PATH="$PATH:/$HOME/.gem/ruby/2.4.0/bin"

# Check this later  $$
export PATH="$PATH:$HOME/LabWork/IITB/Icover:/root/.gem/ruby/2.2.0/bin:$HOME/Matlab/MATLAB_Production_Server/R2015a/bin:$HOME/.gem/ruby/2.2.0/bin:$HOME/.gem/ruby/2.3.0/bin:/opt/schrodinger2016-2:$HOME/Github/mylammps/src:$HOME/Github/espresso/build:$HOME/Github/Scripts/Build:$HOME/Github/Scripts/System"

# Build Paths
###############

# Add /usr/local/lib to libraries PATH
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
export C_INCLUDE_PATH=$C_INCLUDE_PATH:/usr/local/include
export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/usr/local/include
export CPATH=$CPATH:/usr/local/include

# Python Path
##############

export PYTHONPATH=$PYTHONPATH:/home/$USER/Github/espresso:/home/$USER/Github/Linux/acd_fuse:/usr/share/amazon/pyacd

# End with this
##################

if command -v rvm >/dev/null 2>&1; then
  # Add RVM to PATH for scripting. Make sure this is the last PATH variable change.
  export PATH="$PATH:$HOME/.rvm/bin"

  # RVM Fixes (per https://github.com/rvm/rvm/issues/3212)
  # Squelch the warning by appending ' > /dev/null 2>&1' here
  [[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm" > /dev/null 2>&1

  # RVM fixes whatever it considers the problem to be, on its own, in `rvm use`.
  # It also prints some junk we don't care about, so we squelch its output in the same way.
  rvm use default > /dev/null 2>&1
else
  echo "You seem to be missing rvm"
fi
